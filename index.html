<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Dual Street Light Monitor</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
  body { margin:0; font-family:system-ui; }
  header { padding:10px 16px; background:#0078ff; color:white; }
  #map { height:calc(100vh - 50px); }
</style>
</head>
<body>
<header><h3>Street Light Fault Monitor (2 Lights)</h3></header>
<div id="map"></div>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const CHANNEL_ID = "3143341";
const FIELDS = { LAT1:"field1", LON1:"field2", S1:"field3", LAT2:"field4", LON2:"field5", S2:"field6", C1:"field7", C2:"field8" };

const ICONS = {
  green: "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png",
  red: "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png",
  blue: "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png",
  grey: "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-grey.png"
};

let map = L.map('map').setView([19.467960, 72.888108], 16);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);
let markers = [];

async function updateMap(){
  const url = `https://api.thingspeak.com/channels/${CHANNEL_ID}/feeds/last.json`;
  const res = await fetch(url); const data = await res.json();
  const lat1 = parseFloat(data[FIELDS.LAT1]); const lon1 = parseFloat(data[FIELDS.LON1]);
  const lat2 = parseFloat(data[FIELDS.LAT2]); const lon2 = parseFloat(data[FIELDS.LON2]);
  const s1 = data[FIELDS.S1]; const s2 = data[FIELDS.S2];
  const c1 = data[FIELDS.C1]?.toLowerCase() || "grey";
  const c2 = data[FIELDS.C2]?.toLowerCase() || "grey";

  [markers[0], markers[1]].forEach(m => m && map.removeLayer(m));
  markers[0] = L.marker([lat1, lon1], { icon: L.icon({iconUrl:ICONS[c1], iconSize:[25,41], iconAnchor:[12,41]}) }).addTo(map).bindPopup(`LED1 - ${s1}`);
  markers[1] = L.marker([lat2, lon2], { icon: L.icon({iconUrl:ICONS[c2], iconSize:[25,41], iconAnchor:[12,41]}) }).addTo(map).bindPopup(`LED2 - ${s2}`);
}
updateMap();
setInterval(updateMap, 5000);
</script>
</body>
</html>


