<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Street Light Fault Detection</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #111;
      color: #eee;
      text-align: center;
    }

    h2 {
      margin: 10px 0;
      color: #00ff88;
    }

    #map {
      height: 90vh;
      width: 100%;
      border: 2px solid #00ff88;
      border-radius: 10px;
    }

    .status {
      margin: 8px;
      font-size: 16px;
      color: #ccc;
    }
  </style>
</head>

<body>
  <h2>Street Light Fault Detection Map</h2>
  <div class="status">Loading latest data...</div>
  <div id="map"></div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <script>
    // ------------------- CONFIG -------------------
    const THINGSPEAK_CHANNEL_ID = "3143341"; // ‚úÖ Your ThingSpeak channel ID
    const UPDATE_INTERVAL = 2000; // 2 seconds
    const map = L.map("map").setView([19.467960, 72.888108], 17);

    // Tile Layer (OpenStreetMap)
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      attribution: "Map data ¬© OpenStreetMap contributors",
    }).addTo(map);

    let marker = null;

    async function fetchData() {
      try {
        const url = `https://api.thingspeak.com/channels/${THINGSPEAK_CHANNEL_ID}/feeds.json?results=1`;
        const response = await fetch(url);
        const data = await response.json();

        if (!data.feeds || data.feeds.length === 0) {
          document.querySelector(".status").textContent = "‚ö†Ô∏è No data found yet...";
          return;
        }

        const feed = data.feeds[0];
        const lat = parseFloat(feed.field1);
        const lon = parseFloat(feed.field2);
        const status = feed.field3 || "Unknown";
        const color = feed.field4 || "gray";

        document.querySelector(".status").innerHTML = 
          `üìç Lat: ${lat.toFixed(6)}, Lon: ${lon.toFixed(6)}<br>üí° Status: ${status} (${color})`;

        // Marker color
        const icon = L.divIcon({
          className: "custom-icon",
          html: `<div style="background:${color}; width:15px; height:15px; border-radius:50%; border:2px solid #fff;"></div>`,
        });

        if (marker) {
          marker.setLatLng([lat, lon]);

