<!DOCTYPE html>
<html>
<head>
<title>Smart Street Light Monitor</title>
<style>
  #map {
    height: 100vh;
    width: 100%;
  }
</style>

<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAP_API_KEY"></script>

<script>
const channelID = "3126641"; 

// Field mapping from your ThingSpeak channel
const locations = [
    { name: "Light 1", latField: 7, lonField: 8, faultField: 4 },
    { name: "Light 2", latField: 9, lonField: 10, faultField: 5 },
    { name: "Light 3", latField: 11, lonField: 12, faultField: 6 }
];

let map;
let markers = [];

function initMap() {
  map = new google.maps.Map(document.getElementById("map"), {
    zoom: 14,
    center: { lat: 19.464, lng: 72.882 }, 
  });
  fetchData();
  setInterval(fetchData, 10000); // refresh every 10 seconds
}

async function fetchData() {
  const url = `https://api.thingspeak.com/channels/${channelID}/feeds.json`;
  const response = await fetch(url);
  const data = await response.json();
  const lastEntry = data.feeds[data.feeds.length - 1];

  locations.forEach((device, index) => {
    const lat = parseFloat(lastEntry[`field${device.latField}`]);
    const lon = parseFloat(lastEntry[`field${device.lonField}`]);
    const fault = parseInt(lastEntry[`field${device.faultField}`]);

    if (!isNaN(lat) && !isNaN(lon)) {
      const iconColor = fault === 1 ? "red" : "green";
      const markerIcon = {
        url: `http://maps.google.com/mapfiles/ms/icons/${iconColor}-dot.png`
      };

      if (markers[index]) {
        markers[index].setMap(null);
      }

      markers[index] = new google.maps.Marker({
        position: { lat: lat, lng: lon },
        map: map,
        icon: markerIcon,
        title: `${device.name} â†’ Fault: ${fault}`
      });
    }
  });
}
</script>
</head>

<body onload="initMap()">
  <div id="map"></div>
</body>
</html>

