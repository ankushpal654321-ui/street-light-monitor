<!DOCTYPE html>
<html>
<head>
  <title>Street Light Fault Detection Map</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body { height: 100%; margin: 0; padding: 0; }
    #map { height: 100%; width: 100%; }
  </style>
</head>
<body>
  <div id="map"></div>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCo2HswzASIhBBZqiPZFfEHcPjS3qE2p84"></script>
  <script>
  async function updateMap() {
    const response = await fetch("https://api.thingspeak.com/channels/3143341/feeds/last.json");
    const data = await response.json();

    const lat = parseFloat(data.field1);
    const lon = parseFloat(data.field2);
    const status = data.field3;
    const color = data.field4;

    const map = new google.maps.Map(document.getElementById("map"), {
      zoom: 16,
      center: { lat, lng: lon },
    });

    new google.maps.Marker({
      position: { lat, lng: lon },
      map,
      title: `Status: ${status}`,
      icon: {
        path: google.maps.SymbolPath.CIRCLE,
        scale: 10,
        fillColor: color,
        fillOpacity: 1,
        strokeWeight: 1,
        strokeColor: "white",
      },
    });
  }

  updateMap();
  setInterval(updateMap, 5000);
  </script>
</body>
</html>

